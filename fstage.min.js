/**
 * FSTAGE
 *
 * About: A lean javascript library for developing modern web apps
 * Version: 0.0.1
 * License: MIT
 * Source: https://github.com/codi0/fstage
 *
 * Assumes support for: Promise, fetch, Proxy (IE is dead)
 * Checks support for: Symbol.iterator, AbortController
**/
!function(e){"use strict";var t=function(e,n){return t.win&&e===window?t.win:t.doc&&e===document?t.doc:new t.select(e,n,!1)};t.select=function(e,t=document,n=!0){if("string"==typeof e&&(e=/^#[\w-]*$/.test(e)?t.getElementById(e.substr(1)):/^\.[\w-]*$/.test(e)?t.getElementsByClassName(e.substr(1)):/^\w+$/.test(e)?t.getElementsByTagName(e):t.querySelectorAll(e)),e&&!e.nodeType&&e!==window||(e=e?[e]:[]),n)return e;this.length=e.length;for(var r=0;r<e.length;r++)this[r]=e[r]},t.v="0.0.1",t.win=t(window),t.doc=t(document),t.fn=t.prototype=t.select.prototype,t.prototype.length=0,t.prototype.splice=Array.prototype.splice,t.prototype.get=function(e){return this[e]},t.prototype.each=function(e){for(var t=0;t<this.length&&!1!==e.call(this[t],t,this[t]);t++);},"function"==typeof Symbol&&(t.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator]),window.Fstage=t,window.$=window.$||t,"object"==typeof module&&module.exports&&(module.exports=t),"function"==typeof define&&define.amd&&define("fstage",[],function(){return t}),t.each=function(e,t){if("length"in e)for(var n=0;n<e.length&&!1!==t.call(e[n],n,e[n]);n++);else for(var n in e)if(e.hasOwnProperty(n)&&!1===t.call(e[n],n,e[n]))break},t.extend=function(e={}){for(var t=0;t<arguments.length;t++)if(t)for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e},t.type=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},t.toNodes=function(e,t=!1){return e="string"==typeof e?(new DOMParser).parseFromString(e,"text/html").body.childNodes:e&&e.tagName?[e]:e||[],t?e[0]||null:e},t.stripHtml=function(e){var t=document.createElement("div");return t.innerHTML=String(e),t.textContent},t.escHtml=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;",":":"&#58;"};return String(e).replace(/&amp;/g,"&").replace(/[&<>"'\/:]/g,function(e){return t[e]})},t.copy=function(e,n={}){var r=t.type(e);if("string"===r&&n.sanitize)return n.sanitize(e);if("object"!==r&&"array"!==r)return e;var i="array"===r?[]:{};return t.each(e,function(e,r){n.skip&&n.skip.includes(e)||(i[e]=t.copy(r,n))}),i},t.debounce=function(e,t=100){var n;return function(){var r=this,i=arguments;n&&clearTimeout(n),n=setTimeout(function(){e.apply(r,i)},t)}},t.ready=t.prototype.ready=function(e){if(/comp|inter|loaded/.test(document.readyState))return e();document.addEventListener("DOMContentLoaded",e)},t.isEmpty=function(e){return e&&"length"in e?!e.length:e&&e.constructor===Object?!Object.keys(e).length:null===e||!1===e||0==e},t.hash=function(e){"string"!=typeof e&&(e=JSON.stringify(e));for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},t.deviceId=function(e=""){return t.hash(e+navigator.userAgent.replace(/[0-9\.\s]/g,""))},t.prototype.find=function(e){for(var n=[],r=0;r<this.length;r++)for(var i=t.select(e,this[r]),o=0;o<i.length;o++)n.push(i[o]);return t(n)},t.prototype.closest=t.closest=function(e,n=null,r=null){for(var i=[],o=n?[n]:this,s=0;s<o.length;s++)for(var a=o[s];a&&a!==document;){if(a.matches(e)){i.push(a);break}if(a===r)break;a=a.parentNode}return t(i)},t.prototype.parent=function(e=null){for(var t=0;t<this.length;t++){var n=this[t].parentNode;!n||e&&!n.matches(e)||(this[t]=n)}return this};var n=0;t.prototype.on=function(e,r,i,o=!1){"function"==typeof r&&(o=o||i,i=r,r=null),i.guid=i.guid||++n,e=e.trim().split(/\s+/g);for(var s=0;s<e.length;s++)for(var a=0;a<this.length;a++)!function(e,n){if(n.events=n.events||{},!n.events[e]){n.events[e]=n.events[e]||{};var s=function(t){if("click"===e||"submit"===e){if(s._dblAction)return t.preventDefault();s._dblAction=!0,setTimeout(function(){s._dblAction=!1},300)}for(var r in n.events[e])if(n.events[e].hasOwnProperty(r)&&!1===n.events[e][r].call(this,t))return t.stopPropagation()};n.addEventListener(e,s,{capture:!1,passive:/scroll|wheel|mouse|touch|pointer/.test(e)})}n.events[e][i.guid]=function(s){if(o&&delete n.events[e][i.guid],r){var a=t.closest(r,s.target,this);if(!a.length)return;var l=a[0]}else l=this;return i.call(l,s)}}(e[s],this[a]);return this},t.prototype.one=function(e,t,n){return this.on(e,t,n,!0)},t.prototype.off=function(e,t,n){"function"==typeof t&&(n=t),e=e.trim().split(/\s+/g);for(var r=0;r<e.length;r++)for(var i=0;i<this.length;i++){var o=e[r],s=this[i];s.events&&s.events[o]&&s.events[o][n.guid]&&delete s.events[o][n.guid]}},t.prototype.trigger=function(e,t={}){e=e.trim().split(/\s+/g);for(var n=0;n<e.length;n++)for(var r=0;r<this.length;r++){var i=new CustomEvent(e[n],{bubbles:!0,cancelable:!0,detail:t});this[r].dispatchEvent(i)}return this},t.prototype.hasClass=function(e,n=!0,r="contains"){var i=null,o="contains"===r;n&&e&&(e=t.escHtml(e)),e=e.trim().split(/\s+/g);for(var s=0;s<this.length;s++){for(var a=0;a<e.length;a++)if(""!==e[a]){var l=this[s].classList[r](e[a]);o&&!1!==i&&(i=l)}if(o)break}return o?i||!1:this},t.prototype.addClass=function(e,t=!0){return this.hasClass(e,t,"add")},t.prototype.removeClass=function(e,t=!0){return this.hasClass(e,t,"remove")},t.prototype.toggleClass=function(e,t=!0){return this.hasClass(e,t,"toggle")},t.prototype.css=function(e,n,r=!0){if(void 0===n)return this[0]&&this[0].style[e]||"";r&&n&&(e=t.escHtml(e),n=t.escHtml(n));for(var i=0;i<this.length;i++)n?this[i].style.setProperty(e,n):this[i].style.removeProperty(e);return this},t.prototype.attr=function(e,n,r=!0){if(void 0===n)return this[0]?this[0].getAttribute(e):"";r&&n&&(e=t.escHtml(e),n=t.escHtml(n));for(var i=0;i<this.length;i++)n?this[i].setAttribute(e,n):this[i].removeAttribute(e);return this},t.prototype.append=function(e,n="append"){for(var r=t.toNodes(e),i=0;i<this.length;i++)for(var o=0;o<r.length;o++)"append"===n?this[i].appendChild(r[o]):"prepend"===n?this[i].insertBefore(r[o],this[i].firstChild):"before"===n?this[i].parentNode.insertBefore(r[o],this[i]):"after"===n?this[i].parentNode.insertBefore(r[o],this[i].nextSibling):"wrap"===n?(this[i].parentNode.insertBefore(r[o],this[i]),r[o].appendChild(this[i])):"replace"===n&&this[i].parentNode.replaceChild(r[o],this[i]);return this},t.prototype.prepend=function(e){return this.append(e,"prepend")},t.prototype.after=function(e){return this.append(e,"after")},t.prototype.before=function(e){return this.append(e,"before")},t.prototype.wrap=function(e){return this.append(e,"wrap")},t.prototype.replaceWith=function(e){return this.append(e,"replace")},t.prototype.remove=function(e){for(var t=0;t<this.length;t++)e?!0===e?this[t].innerHTML="":this[t].removeChild(e):this[t].parentNode.removeChild(this[t]);return this},t.prototype.empty=function(){return this.remove(!0)},t.prototype.html=function(e,t="innerHTML"){if(void 0===e)return this[0]?this[0][t]:"";for(var n=0;n<this.length;n++)this[n][t]=e;return this},t.prototype.text=function(e){return this.html(e,"textContent")},t.prototype.val=function(e,n=!0){if(void 0===e)return this[0]?this[0].value:"";n&&e&&(e=t.escHtml(e));for(var r=0;r<this.length;r++)this[r].value=e||"";return this},t.prototype.animate=function(e,t={}){for(var n=/(^|\s|\-)in(\s|\-|$)/.test(e),r=/(^|\s|\-)out(\s|\-|$)/.test(e),i=0;i<this.length;i++)!function(i){var o=i.classList.contains("hidden");if(!(r&&o||n&&!o)){var s=function(e){t.onStart&&t.onStart(e),i.removeEventListener("transitionstart",s)},a=function(n){r&&i.classList.add("hidden"),i.classList.remove("animate"),i.classList.remove.apply(i.classList,e.split(/\s+/g)),t.onEnd&&t.onEnd(n),i.removeEventListener("transitionend",a),i.removeEventListener("transitioncancel",a)};i.addEventListener("transitionstart",s),i.addEventListener("transitionend",a),i.addEventListener("transitioncancel",a),r&&i.classList.add("animate"),r||i.classList.add.apply(i.classList,e.split(/\s+/g)),requestAnimationFrame(function(){r&&i.classList.add.apply(i.classList,e.split(/\s+/g)),r||i.classList.add("animate"),requestAnimationFrame(function(){r||i.classList.remove("hidden")})})}}(this[i]);return this},t.prototype.sliding=function(e={}){var n,r,i;e=t.extend({x:!0,y:!1},e);var o=function(e,t){return e.touchMoves?e.touchMoves[0][t]:e[t]},s=function(t){if(n){var s=o(t,"pageX"),a=o(t,"pageY"),l=e.x?s-r:r,u=e.y?a-i:i;n.style.transform="translate3d("+l+"px, "+u+"px, 0);",e.onMove&&e.onMove(n,{startX:r,startY:i,pageX:s,pageY:a})}},a=function(l){n&&(t(document).off("mousemove touchmove",s).off("mouseup touchend",a),n.style.transition="transform 300ms ease-in-out",requestAnimationFrame(function(){var t="string"!=typeof n.style.transform,s=function(e){!t&&n.removeEventListener("transitionend",s),n&&(n.style.transition=null),n&&(n.style.userSelect=null),n=r=i=null};!t&&n.addEventListener("transitionend",s),e.onEnd&&e.onEnd(n,{startX:r,startY:i,pageX:o(l,"pageX"),pageY:o(l,"pageY")}),n&&(n.style.transform=null),t&&s()}))};this.on("mousedown touchstart",function(l){n||(n=this,r=o(l,"pageX"),i=o(l,"pageY"),n.style.userSelect="none",t(document).on("mousemove touchmove",s).on("mouseup touchend",a),e.onStart&&e.onStart(n,{startX:r,startY:i}))})},t.prototype.notice=function(e,n={}){for(var r=t.toNodes('<div class="notice '+(n.type||"info")+' hidden">'+e+"</div>",!0),i=0;i<this.length;i++){var o=r.cloneNode(!0);n.prepend?this[i].insertBefore(o,this[i].firstChild):this[i].appendChild(o);var s=t(o).animate((n.animate||"none")+" in");n.hide&&n.hide>0&&setTimeout(function(){s.animate((n.animate||"none")+" out",{onEnd:function(){o.parentNode.removeChild(o)}})},n.hide)}return this},t.prototype.overlay=function(e,n={}){var r='<div class="overlay">';r+='<div class="inner" style="width:'+(n.width||"90%")+';">',r+='<div class="head">',r+='<div class="title">'+(n.title||"")+"</div>",!1!==n.close&&(r+='<div class="close" onclick="this.parentNode.parentNode.parentNode.remove()">X</div>'),r+="</div>",r+='<div class="body">'+e+"</div>",r+="</div>",r+="</div>";for(var i=0;i<this.length;i++)this[i].appendChild(t.toNodes(r,!0))},t.pageTransition=function(e,n,r,i,o={}){r&&((r=t(r)).css("z-index",o.reverse?99:98),r.animate((o.reverse?n:i)+" out")),(e=t(e)).css("z-index",o.reverse?98:99),e.animate((o.reverse?i:n)+" in",{onStart:o.onStart,onEnd:function(t){r&&(r.addClass("hidden"),r.attr("style",null)),e.attr("style",null),o.onEnd&&o.onEnd(t)}})},t.ajax=function(e,n={}){var r="undefined"!=typeof AbortController?new AbortController:null;n=t.extend({timeout:5e3,signal:r&&r.signal},n);var i=new Promise(function(t,i){var o=n.timeout&&setTimeout(function(){i(new Error("Ajax request timeout")),r&&r.abort()},n.timeout);fetch(e,n).finally(function(){o&&clearTimeout(o)}).then(t,i)});return n.success&&(i=i.then(function(e){n.success(e)})),n.error&&(i=i.catch(function(e){n.error(e)})),i},t.websocket=function(e,n={},r=!1){if(!0!==r)return new t.websocket(e,n,!0);n=t.extend({protocols:[],retries:50,wait:2e3},n);var i=this,o=!1,s=0,a={},l=[],u={},c=function(e,t="message",n=null,r=!1){a[t]=a[t]||[],a[t]=a[t].filter(function(t){return t.listener!==e||t.channel!==n}),r||a[t].push({listener:e,channel:n})},d=function(e,t){for(var n=0;n<(a[e]||[]).length;n++){var r,i=a[e][n];if(!e||["open","message","error","close"].includes(e))return i.listener(t);try{r=JSON.parse(t.data)}catch(e){}if(!r||r.event!==e)return;i.channel&&r.channel!==i.channel||i.listener(r.data||r.message||r,t)}};return i.open=function(){if(!i.ws)return i.ws=new WebSocket(e.replace(/^http/i,"ws"),n.protocols),i.ws.addEventListener("open",function(e){var t=l;l=[],o=!0;for(var n=0;n<t.length;n++)i.send.apply(i,t[n]);d("open",e)}),i.ws.addEventListener("message",function(e){for(var t in d("message",e),a)a.hasOwnProperty(t)&&!["open","message","error","close"].includes(t)&&d(t,e)}),i.ws.addEventListener("error",function(e){d("error",e)}),i.ws.addEventListener("close",function(e){i.ws=null,o=!1,u={},d("close",e),1e3===e.code||s>0&&s>=n.retries||setTimeout(function(){s++,i.connect()},n.wait)}),i},i.close=function(e=1e3,t=""){return i.ws&&i.ws.close(e,t),i},i.send=function(e,t={}){return o&&i.ws.send(t.encode?JSON.stringify(e):e),l=l.filter(function(t){return t[0]!==e}),o&&!t.queue||l.push([e,t]),i},i.on=function(e,t){return c(t,e),i},i.off=function(e,t){return c(t,e,null,!0),i},i.trigger=function(e,t){return i.send({event:e,data:t},{encode:!0})},i.sub=function(e,t,n=!1){return c(t,"publish",e,n),u[e]||(i.send({event:"subscribe",channel:e},{encode:!0,queue:!n}),u[e]=!0),i},i.unsub=function(e,t){return i.sub(e,t,!0)},i.pub=function(e,t){return i.send({event:"publish",channel:e,data:t},{encode:!0})},window.addEventListener("beforeunload",function(e){i.close()}),i.open()};var r={};t.pub=function(e,t={}){for(var n=0;n<(r[e]||[]).length;n++)r[e][n](t)},t.sub=function(e,t){r[e]=r[e]||[],r[e].push(t)},t.unsub=function(e,t){for(var n=0;n<(r[e]||[]).length;n++)r[e][n]===t&&r[e].splice(n)};var i,o=[],s=[];t.tick=function(e,t=!1){t?s.push(e):o.push(e),i=i||Promise.resolve().then(function(){var e=o.concat(s);for(i=null,o=[],s=[];e.length;)e.shift().call()})},t.nextTick=function(e){return t.tick(e,!0)},t.syncDom=function(e,t,n={}){var r=function(e,t){e.isEqualNode(t)||n.onCanSkip&&n.onCanSkip(e,t)||(i(e,t),s(e,t))},i=function(e,t){if(11!==t.nodeType&&11!==e.nodeType){for(var n=e.attributes,r=0;r<n.length;r++)e.getAttribute(n[r].name)!==n[r].value&&e.setAttribute(n[r].name,n[r].value);var i=e.attributes;for(r=0;r<i.length;r++)t.hasAttribute(i[r].name)||e.removeAttribute(i[r].name)}},o=function(e,t,n){e[n]=t[n],e[e[n]?"setAttribute":"removeAttribute"](n,"")},s=function(e,t){var n,i,s=t.firstChild,a=e.firstChild;if("TEXTAREA"!==e.nodeName){e:for(;s;){for(i=s.nextSibling;a;){var l=void 0;if(n=a.nextSibling,s.isSameNode&&s.isSameNode(a)){s=i,a=n;continue e}if(a.nodeType===s.nodeType&&(1===a.nodeType&&(l=a.nodeName===s.nodeName)&&r(a,s),3!==a.nodeType&&8!==a.nodeType||(l=!0,a.nodeValue=s.nodeValue)),l){s=i,a=n;continue e}e.removeChild(a),a=n}e.appendChild(s),s=i,a=n}for(;a;){var u=a.nextSibling;e.removeChild(a),a=u}if("INPUT"===e.nodeName&&(o(e,t,"checked"),o(e,t,"disabled"),e.value=t.value,t.hasAttribute("value")||e.removeAttribute("value")),"SELECT"===e.nodeName&&!t.hasAttribute("multiple")){for(var c,d=e.firstChild,f=-1,p=0;d;){if("OPTGROUP"===d.nodeName&&(d=(c=d).firstChild),"OPTION"===d.nodeName){if(d.hasAttribute("selected")){f=p;break}p++}!(d=d.nextSibling)&&c&&(d=c.nextSibling,c=null)}e.selectedIndex=f}if("OPTION"===e.nodeName){if(e.parentNode){var h=e.parentNode,v=h.nodeName;"OPTGROUP"===v&&(v=(h=h.parentNode)&&h.nodeName),"SELECT"!==v||h.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(fromEl.setAttribute("selected","selected"),fromEl.removeAttribute("selected")),h.selectedIndex=-1)}o(e,t,"selected")}}else e.value=t.value},a=e;if("string"==typeof t){var l=document.createElement("div");l.innerHTML=t,t=l.firstChild}if(1===a.nodeType)if(1===t.nodeType){if(e.nodeName!==t.nodeName)for(a=document.createElement(t.nodeName);e.firstChild;)a.appendChild(e.firstChild)}else a=t;if(3===a.nodeType||8===a.nodeType){if(t.nodeType===a.nodeType)return a.nodeValue=t.nodeValue,a;a=t}if(a!==t){if(t.isSameNode&&t.isSameNode(a))return;r(a,t)}return a!==e&&e.parentNode&&e.parentNode.replaceChild(a,e),a},t.watch=function(e,n=null){return(e=e||{}).__link=e.__link||[],n&&!e.__link.includes(n)&&e.__link.push(n),e.__isProxy?e:new Proxy(e,{get:function(e,r){return"__isProxy"===r||("__link"!==r&&"object"==typeof e[r]&&(e[r]=t.watch(e[r],n)),e[r])},set:function(e,n,r){if("__isProxy"!==n&&"__link"!==n&&e[n]!==r){var i=e[n];e[n]=r,t.pub("watch",{obj:e,key:n,from:i,to:r})}return!0},deleteProperty:function(e,n){if("__isProxy"!==n&&"__link"!==n&&void 0!==e[n]){var r=e[n];delete e[n],t.pub("watch",{obj:e,key:n,from:r,to:void 0})}return!0}})},t.component=function(e,n={}){var r,i,o,s,a={name:e,children:[],data:(n=t.extend({el:null,parent:null,data:{},template:function(){},escape:t.escHtml},n)).data};return delete n.data,a.render=function(e,l,u){if(i||(i=!0,o=!0,n.el=e||n.el,a.data=t.watch(l||a.data,a.render),t.sub("watch",function(e){e.obj.__link.includes(a.render)&&(o=!0,a.render())})),!r&&o){r=!0,o=!1;var c=function(){if((e=s||t.select(n.el))&&e.length){s=e;for(var i=t.copy(a.data,{skip:["__isProxy","__link"],sanitize:n.escape}),o=n.template(i)||"",l=0;l<e.length;l++){e[l].setAttribute("data-component",a.name);var u=e[l].cloneNode(!1);u.innerHTML=o,t.syncDom(e[l],u,{onCanSkip:function(t,n){return t.getAttribute("data-component")&&e[l]!==t}})}for(var c=0;c<a.children.length;c++)a.children[c].render(null,null,!0)}r=!1};u?c():t.tick(c)}},n.parent&&n.parent.children.push(a),n.el&&a.render(),a},t.router=new function(){var e=!1,n=this,r=!1,i=0,o={routes:{},baseUrl:"",home:"home",notfound:"notfound",pageClass:"page",history:!0};n.current=function(){return o.last},n.has=function(e){return o.onHas?o.onHas(e,o.routes):o.routes[e]&&o.routes[e].length},n.on=function(e,t){e=e.trim().split(/\s+/g);for(var r=0;r<e.length;r++){var i=t.bind({});i.runs=0,o.routes[e[r]]=o.routes[e[r]]||[],o.routes[e[r]].push(i)}return n},n.off=function(e,t){return o.routes[e]=(o.routes[e]||[]).filter(function(e){return e!==t}),n},n.trigger=function(e,r={},s="push"){if((r=t.extend({name:e,last:o.last,params:{}},r)).is404=!n.has(r.name),r.is404&&!n.has(o.notfound))return!1;r.is404&&o.notfound&&(r.name=o.notfound);var a=o.last,l=[":before",r.name,":after"];r.orig=r.name;for(var u=0;u<l.length;u++)for(var c=0;c<(o.routes[l[u]]||[]).length;c++){var d=o.routes[l[u]][c],f=d(r,d.runs);if(d.runs++,!1===f||a!==o.last)return!1;f&&f.name&&(r=f,a=l[1]=o.last=f.name)}if(o.history&&s&&"false"!==s){var p="scroll"in r?r.scroll||0:window.pageYOffset;history[s+"State"]({id:++i,name:r.name,scroll:p},"",n.url(r.name))}return o.last=r.name,!0},n.redirect=function(e,t={}){return n.trigger(e,t,"replace")},n.back=function(){history.length>2?(e=!0,history.back()):n.trigger(o.home,{isBack:!0},null)},n.url=function(e,t=!1){if(!o.baseUrl)return location.pathname+location.search;var n=/\?|\#/.test(o.baseUrl)?"":"/",r=(e=o.home===e&&"/"===n?"":e,(o.baseUrl+(e?n+e:"")).replace(/\/\//,"/"));return t?r.replace(/\/$/,""):r},n.show=function(e,r="data-if"){var i=n.current();if(i){var s=t("."+o.pageClass+"."+i);s.find("["+r+"]").addClass("hidden"),s.find("["+r+'="'+e+'"]').removeClass("hidden")}},n.start=function(s={}){if(r)return n;r=!0;(o=t.extend(o,s)).notfound;var a=(location.pathname+location.search+location.hash).replace(/\/$/,"").split(/[^\w-]+/g).pop();return a&&n.has(a)||(a=o.home),n.redirect(a),t(window).on("click","[data-route]",function(e){var r={params:{}},i=this.getAttribute("data-route"),o=(this.getAttribute("data-params")||"").split(";"),s=this.getAttribute("data-history")||"push";if(i&&i.length){for(var a=0;a<o.length;a++){var l=o[a].split(":",2);l.length>1&&(r.params[l[0].trim()]=l[1].trim())}if("submit"===this.getAttribute("type")){var u=t.closest("form",this);if(u&&u.length)return u.one("submit",function(e){e.preventDefault(),n.trigger(i,r,s)})}e.preventDefault(),n.trigger(i,r,s)}}),t(window).on("popstate",function(t){if(t.state&&t.state.name){var r=e||i>t.state.id;i=t.state.id,e=!1,n.trigger(t.state.name,{isBack:r,scroll:t.state.scroll},null)}}),n}},t.form=function(e,n={}){if(!document[e])throw new Error("Form not found in HTML:",e);var r="",i={},o={},s=document[e];n.fields=n.fields||{};var a=function(e,t){s[e].classList.add("has-error");var n=document.createElement("div");n.classList.add("error"),n.innerHTML=t,s[e].parentNode.insertBefore(n,s[e].nextSibling),o[e]=t},l=function(e){var t=s[e].parentNode.querySelector(".error");t&&t.parentNode.removeChild(t),s[e].classList.remove("has-error"),o[e]&&delete o[e]};return s.step=function(e=null){return e&&(r=e,t(s).find(".step").addClass("hidden"),t(s).find(".step."+r).removeClass("hidden")),r},s.err=function(e=null,t=null){return e&&t&&a(e,t),e?o[e]||null:o},s.val=function(e=null){return e?i[e]||null:i},s.reset=function(e=null,r=[]){t.each(n.fields,function(t){!s[t]||r.includes(t)||e&&e!==t||(s[t].value=i[t]="",l(t))})},s.isValid=function(e=null){var r=!1;return t.each(n.fields,function(t){if((!e||t===e)&&s[t]){var o=s[t].value;if(l(t),n.fields[t].filter&&(o=n.fields[t].filter.call(s,o)),n.fields[t].validator){var u=n.fields[t].validator.call(s,o);u instanceof Error&&(a(t,u.message),r=!0)}i[t]=o}}),e||!n.onSuccess||r||n.onSuccess(i,o),!e&&n.onError&&r&&n.onError(i,o),!r},t.each(n.fields,function(e){s[e]&&(s[e].addEventListener("focus",function(t){l(e)}),s[e].addEventListener("blur",function(t){s.isValid(e)}))}),s}}();